#!/bin/bash
# Written by Charles Moye cmoye@digium.com
# Copyright 2012-2017 Charles Moye
#
#Licensed under the Apache License, Version 2.0 (the "License");
#you may not use this file except in compliance with the License.
#You may obtain a copy of the License at
#
#	http://www.apache.org/licenses/LICENSE-2.0
#
#Unless required by applicable law or agreed to in writing, software
#distributed under the License is distributed on an "AS IS" BASIS,
#WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#See the License for the specific language governing permissions and
#limitations under the License.

. /usr/local/etc/disk-tools.sh

checkroot;

identify_drives;
for dr in "${ALL_SMART[@]}"; do
  smart_check "$dr";
  echo;
done;

# Add a -H check for failure/failing attributes. Print a message to Replace drive ASAP
# Check return value mask, bits 3-5 (inclusive) are failures for us
# 3: Disk Failing, 4: Attributes failing, 5: Attributes have failed in the past
# val=$?; mask=1
# for i in 0 1 2 3 4 5 6 7; do
#   echo "Bit $i: $(((val & mask) && 1))"
#   mask=$((mask << 1))
# done
# check bit 3 only: smartstat=$(($val & 8)) # 8=2^3


# Add a collection of the attributes with these extra format flags:
# -f brief -f hex,id
# smartctl -f brief $vol|sed -ne '/SMART Attributes/,/^$/ { s/^\s\+//;s/\s\+/,/g;p; }'

# Search out the main ones we care about, for at least Kingston SSDs
# Expand into regular HDDs, and Intel & Toshiba SSDs
